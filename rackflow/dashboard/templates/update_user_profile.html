{% extends "base.html" %}
{% load static %}

{% block content %}
<main class="flex-1 container mx-auto px-4 sm:px-6 py-8">
    <div
        class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8"
    >
        <h2
            class="text-2xl sm:text-3xl font-semibold text-gray-800 mb-4 sm:mb-0 relative expand-underline"
        >
            Edit User Profile
        </h2>
    </div>

    <div class="bg-white p-8 rounded-xl shadow-lg">
        {{ form.non_field_errors }}
        <form id="profileUpdateForm" class="space-y-6" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {% for field in form %}
                {% if field.field.widget.input_type == 'file' %}
                <div>
                    <label
                        class="block text-sm font-medium text-gray-700 mb-1"
                        for="{{ field.id_for_label }}"
                    >
                        {{ field.label }}
                    </label>
                    <div
                        class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg"
                    >
                        <div class="space-y-1 text-center">
                            <!-- Image placeholder and preview -->
                            <span id="image-placeholder" class="material-icons text-gray-400 text-5xl"
                            >image</span
                            >
                            <img
                                alt="Profile Image Preview"
                                id="image-preview"
                                style="width:96px; height:96px; object-fit:cover; margin:auto; display:none; border-radius:50%;"
                                {% if field.value %}
                                    src="{{ field.value.url }}"
                                    style="display:block;"
                                {% endif %}
                            />
                            <div class="flex text-sm text-gray-600">
                                <label
                                    class="relative cursor-pointer bg-white rounded-md font-medium text-[var(--background)] hover:text-[var(--background-dark)] focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-[var(--background)]"
                                    for="{{ field.id_for_label }}"
                                >
                                    <span>Upload a file</span>
                                    <input
                                        class="sr-only"
                                        type="file"
                                        name="{{ field.name }}"
                                        id="{{ field.id_for_label }}"
                                        accept="image/*" {# Restrict to image files #}
                                    />
                                </label>
                                <p class="pl-1">or drag and drop</p>
                            </div>
                            <p class="text-xs text-gray-500">
                                PNG, JPG, GIF up to 10MB
                            </p>
                        </div>
                    </div>
                    <p class="text-[var(--background-dark)] text-sm mt-1"> {{ field.errors.as_text }}</p>
                </div>

                {% else %}
                <div>
                    <label
                        class="block text-sm font-medium text-gray-700 mb-1"
                        for="{{ field.id_for_label }}"
                    >{{ field.label }}</label
                    >

                    <input
                        class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-[var(--background)] focus:border-[var(--background)]"
                        type="{{ field.field.widget.input_type }}"
                        name="{{ field.name }}"
                        id="{{ field.id_for_label }}"
                        value="{{ field.value|default_if_none:'' }}"
                        {% if field.field.required %}required{% endif %}
                    />
                    {% if field.help_text %}
                        <p class="text-gray-500 text-xs italic mt-1">{{ field.help_text }}</p>
                    {% endif %}
                    <p class="text-[var(--background-dark)] text-sm mt-1"> {{ field.errors.as_text }}</p>
                </div>

                {% endif %}
            {% endfor %}

            <div class="pt-4 flex justify-end space-x-3">
                <a
                    class="px-6 py-2.5 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--background)]"
                    {% comment %} href="{% url 'dashboard' %}" {# this will be active after finishing list users route #} {% endcomment %}
                >
                    Cancel
                </a>
                <button
                    class="px-6 py-2.5 bg-[var(--background)] text-white rounded-lg text-sm font-medium hover:bg-[var(--background-dark)] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--background)]"
                    type="submit"
                >
                    Save Changes {# Changed button text #}
                </button>
            </div>
        </form>
    </div>
</main>



{% endblock content %}
